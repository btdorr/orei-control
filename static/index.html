<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orei UHD-401MV Control Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="static/styles.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col">
                <h1 class="h2 mb-0">
                    <i class="bi bi-display me-2"></i>
                    Orei UHD-401MV Control Panel
                </h1>
                <p class="text-muted mb-0">HDMI Multiviewer RS-232 Control Interface</p>
            </div>
            <div class="col-auto">
                <div class="d-flex align-items-center">
                    <span class="status-indicator status-off" id="powerIndicator"></span>
                    <span id="powerStatus" class="me-3">Offline</span>
                    <button class="btn btn-primary me-2" id="refreshBtn">
                        <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                    <!-- System Menu -->
                    <div class="dropdown me-2">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="systemDropdown" data-bs-toggle="dropdown" aria-expanded="false" title="System Menu">
                            <i class="bi bi-gear-fill"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="systemDropdown">
                            <li><h6 class="dropdown-header">System Control</h6></li>
                            <li><a class="dropdown-item text-warning" href="#" id="shutdownMenuItem">
                                <i class="bi bi-power me-2"></i>Shutdown System
                            </a></li>
                            <li><a class="dropdown-item text-info" href="#" id="restartMenuItem">
                                <i class="bi bi-arrow-clockwise me-2"></i>Restart System
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-success" href="#" id="updateMenuItem">
                                <i class="bi bi-download me-2"></i>System Update
                            </a></li>
                        </ul>
                    </div>
                    <!-- Theme Selector -->
                    <div class="dropdown theme-selector">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="themeDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-palette"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="themeDropdown">
                            <li><a class="dropdown-item" href="#" data-theme-value="auto"><i class="bi bi-circle-half"></i> Automatic</a></li>
                            <li><a class="dropdown-item" href="#" data-theme-value="light"><i class="bi bi-sun"></i> Light</a></li>
                            <li><a class="dropdown-item" href="#" data-theme-value="dark"><i class="bi bi-moon"></i> Dark</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <ul class="nav nav-tabs nav-fill mb-4" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="remote-tab" data-bs-toggle="tab" data-bs-target="#remote-panel" type="button" role="tab" aria-controls="remote-panel" aria-selected="true">
                    <i class="bi bi-controller me-2"></i>Remote Control
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="advanced-tab" data-bs-toggle="tab" data-bs-target="#advanced-panel" type="button" role="tab" aria-controls="advanced-panel" aria-selected="false">
                    <i class="bi bi-gear me-2"></i>Advanced Settings
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="mainTabContent">
            <!-- Remote Control Tab -->
            <div class="tab-pane fade show active" id="remote-panel" role="tabpanel" aria-labelledby="remote-tab">
                <div class="row">
                    <!-- Essential Controls -->
                    <div class="col-lg-4 col-xl-3">
                        <!-- Primary Controls -->
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-sliders me-2"></i>Primary Controls
                            </div>
                            <div class="card-body">
                                <!-- Power Control -->
                                <div class="d-grid mb-3">
                                    <button class="btn btn-lg btn-danger" id="powerBtn" disabled>
                                        <i class="bi bi-power"></i> Power Off
                                    </button>
                                </div>

                                <!-- Display Mode -->
                                <label class="form-label">Display Mode</label>
                                <select class="form-select mb-3" id="displayMode">
                                    <option value="1">Single Screen</option>
                                    <option value="2">PIP (Picture-in-Picture)</option>
                                    <option value="3">PBP (Picture-by-Picture)</option>
                                    <option value="4">Triple Screen</option>
                                    <option value="5">Quad Screen</option>
                                </select>

                                <!-- Window Input Sources -->
                                <div id="windowInputSection">
                                    <label class="form-label">Window Input Sources</label>
                                    <div id="windowInputControls" class="mb-3">
                                        <!-- Dynamic input source dropdowns will be added here -->
                                    </div>
                                </div>

                                <!-- Audio Source -->
                                <label class="form-label">Audio Source</label>
                                <select class="form-select" id="audioSource">
                                    <option value="0">Follow Window 1</option>
                                    <option value="1">HDMI 1</option>
                                    <option value="2">HDMI 2</option>
                                    <option value="3">HDMI 3</option>
                                    <option value="4">HDMI 4</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Roku Remotes -->
                    <div class="col-lg-8 col-xl-9">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-controller me-2"></i>Roku Remote Controls</span>
                                <button class="btn btn-sm btn-outline-primary" id="manageRokuBtn" style="display: none;">
                                    <i class="bi bi-gear"></i> Manage Devices
                                </button>
                            </div>
                            <div class="card-body">
                                <!-- Configuration prompt when no devices mapped -->
                                <div id="rokuConfigPrompt" class="text-center" style="display: none;">
                                    <div class="mb-3">
                                        <i class="bi bi-tv display-4 text-muted"></i>
                                    </div>
                                    <h5>No Roku Devices Configured</h5>
                                    <p class="text-muted">Configure your Roku devices to control them from the multiviewer interface.</p>
                                    <button class="btn btn-primary" id="configureRokuBtn">
                                        <i class="bi bi-gear"></i> Configure Roku Devices
                                    </button>
                                </div>
                                
                                <!-- Remote controls container -->
                                <div class="row" id="rokuRemotes">
                                    <p class="text-muted text-center">Loading Roku remotes...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Settings Tab -->
            <div class="tab-pane fade" id="advanced-panel" role="tabpanel" aria-labelledby="advanced-tab">
                <div class="row">
                    <!-- Left Column - Advanced Controls -->
                    <div class="col-lg-4">
                        <!-- Advanced Audio Control -->
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-volume-up me-2"></i>Audio Control
                            </div>
                            <div class="card-body">
                                <label class="form-label">Audio Source</label>
                                <select class="form-select mb-3" id="audioSourceAdvanced">
                                    <option value="0">Follow Window 1</option>
                                    <option value="1">HDMI 1</option>
                                    <option value="2">HDMI 2</option>
                                    <option value="3">HDMI 3</option>
                                    <option value="4">HDMI 4</option>
                                </select>
                                
                                <label class="form-label d-flex justify-content-between">
                                    <span>Volume</span>
                                    <span id="volumeValue">50</span>
                                </label>
                                <div class="volume-control mb-3">
                                    <button class="btn btn-outline-secondary" type="button" id="volumeDownBtn" title="Volume Down">
                                        <i class="bi bi-volume-down"></i>
                                    </button>
                                    <input type="range" class="form-range" id="volumeSlider" min="0" max="100" value="50">
                                    <button class="btn btn-outline-secondary" type="button" id="volumeUpBtn" title="Volume Up">
                                        <i class="bi bi-volume-up"></i>
                                    </button>
                                </div>
                                
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="muteSwitch">
                                    <label class="form-check-label" for="muteSwitch">
                                        Mute Audio
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Output Settings -->
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-gear me-2"></i>Output Settings
                            </div>
                            <div class="card-body">
                                <label class="form-label">Resolution</label>
                                <select class="form-select mb-3" id="outputResolution">
                                    <option value="1">4096x2160p60</option>
                                    <option value="2">4096x2160p50</option>
                                    <option value="3">3840x2160p60</option>
                                    <option value="4">3840x2160p50</option>
                                    <option value="5">3840x2160p30</option>
                                    <option value="6">3840x2160p25</option>
                                    <option value="7">1920x1200p60RB</option>
                                    <option value="8">1920x1080p60</option>
                                    <option value="9">1920x1080p50</option>
                                    <option value="10">1360x768p60</option>
                                    <option value="11">1280x800p60</option>
                                    <option value="12">1280x720p60</option>
                                    <option value="13">1280x720p50</option>
                                    <option value="14">1024x768p60</option>
                                </select>
                                
                                <label class="form-label">HDCP</label>
                                <select class="form-select" id="outputHDCP">
                                    <option value="1">HDCP 1.4</option>
                                    <option value="2">HDCP 2.2</option>
                                    <option value="3">HDCP OFF</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Middle Column - Display Settings & Preview -->
                    <div class="col-lg-4">
                        <!-- Advanced Display Mode Settings -->
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-grid-3x3-gap me-2"></i>Display Mode Settings
                            </div>
                            <div class="card-body">
                                <label class="form-label">Current Mode</label>
                                <select class="form-select mb-3" id="displayModeAdvanced">
                                    <option value="1">Single Screen</option>
                                    <option value="2">PIP (Picture-in-Picture)</option>
                                    <option value="3">PBP (Picture-by-Picture)</option>
                                    <option value="4">Triple Screen</option>
                                    <option value="5">Quad Screen</option>
                                </select>
                                
                                <!-- Mode-specific settings -->
                                <div id="modeSettings">
                                    <!-- PIP Settings -->
                                    <div id="pipSettings" style="display: none;">
                                        <h6 class="mb-3">PIP Settings</h6>
                                        <label class="form-label">Position</label>
                                        <select class="form-select mb-3" id="pipPosition">
                                            <option value="1">Left Top</option>
                                            <option value="2">Left Bottom</option>
                                            <option value="3">Right Top</option>
                                            <option value="4">Right Bottom</option>
                                        </select>
                                        <label class="form-label">Size</label>
                                        <select class="form-select" id="pipSize">
                                            <option value="1">Small</option>
                                            <option value="2">Medium</option>
                                            <option value="3">Large</option>
                                        </select>
                                    </div>
                                    
                                    <!-- PBP Settings -->
                                    <div id="pbpSettings" style="display: none;">
                                        <h6 class="mb-3">PBP Settings</h6>
                                        <label class="form-label">Mode</label>
                                        <select class="form-select mb-3" id="pbpMode">
                                            <option value="1">Mode 1</option>
                                            <option value="2">Mode 2</option>
                                        </select>
                                        <label class="form-label">Aspect Ratio</label>
                                        <select class="form-select" id="pbpAspect">
                                            <option value="1">Full Screen</option>
                                            <option value="2">16:9</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Triple Settings -->
                                    <div id="tripleSettings" style="display: none;">
                                        <h6 class="mb-3">Triple Screen Settings</h6>
                                        <label class="form-label">Mode</label>
                                        <select class="form-select mb-3" id="tripleMode">
                                            <option value="1">Mode 1</option>
                                            <option value="2">Mode 2</option>
                                        </select>
                                        <label class="form-label">Aspect Ratio</label>
                                        <select class="form-select" id="tripleAspect">
                                            <option value="1">Full Screen</option>
                                            <option value="2">16:9</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Quad Settings -->
                                    <div id="quadSettings" style="display: none;">
                                        <h6 class="mb-3">Quad Screen Settings</h6>
                                        <label class="form-label">Mode</label>
                                        <select class="form-select mb-3" id="quadMode">
                                            <option value="1">Mode 1</option>
                                            <option value="2">Mode 2</option>
                                            <option value="3">Mode 3</option>
                                        </select>
                                        <label class="form-label">Aspect Ratio</label>
                                        <select class="form-select" id="quadAspect">
                                            <option value="1">Full Screen</option>
                                            <option value="2">16:9</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Display Preview -->
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-display me-2"></i>Display Preview
                            </div>
                            <div class="card-body">
                                <div class="display-diagram" id="displayDiagram">
                                    <!-- Dynamic content will be inserted here -->
                                </div>
                                <div class="mt-3">
                                    <p class="text-muted mb-2">Click on a window to select input source</p>
                                    <div class="row g-2" id="inputSelectors" style="display: none;">
                                        <div class="col">
                                            <label class="form-label">Selected Window: <span id="selectedWindow">-</span></label>
                                            <select class="form-select" id="windowInputSelect">
                                                <option value="1">HDMI 1</option>
                                                <option value="2">HDMI 2</option>
                                                <option value="3">HDMI 3</option>
                                                <option value="4">HDMI 4</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column - Command History & Debug -->
                    <div class="col-lg-4">
                        <!-- Serial Port Configuration -->
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-usb-symbol me-2"></i>Serial Port Configuration
                            </div>
                            <div class="card-body">
                                <label class="form-label">Serial Port</label>
                                <div class="input-group mb-3">
                                    <select class="form-select" id="serialPortSelect">
                                        <option value="">Loading ports...</option>
                                    </select>
                                    <button class="btn btn-outline-secondary" type="button" id="refreshPortsBtn" title="Refresh Available Ports">
                                        <i class="bi bi-arrow-clockwise"></i>
                                    </button>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <small class="text-muted">Current: <span id="currentSerialPort">/dev/serial0</span></small>
                                    <span class="badge" id="serialConnectionStatus">Disconnected</span>
                                </div>
                                
                                <button class="btn btn-primary w-100" id="updateSerialPortBtn" disabled>
                                    <i class="bi bi-check"></i> Update Serial Port
                                </button>
                                
                                <div class="mt-3">
                                    <small class="text-muted">
                                        <strong>Common Ports:</strong><br>
                                        • /dev/serial0 - Raspberry Pi GPIO<br>
                                        • /dev/ttyUSB0 - USB Serial Adapter<br>
                                        • /dev/ttyAMA0 - Alternative Pi GPIO
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- Command History -->
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-terminal me-2"></i>Command History</span>
                                <button class="btn btn-sm btn-secondary" id="clearHistory">Clear</button>
                            </div>
                            <div class="card-body p-0">
                                <div class="command-history">
                                    <table class="table table-sm mb-0">
                                        <thead>
                                            <tr>
                                                <th>Time</th>
                                                <th>Command</th>
                                                <th>Response</th>
                                            </tr>
                                        </thead>
                                        <tbody id="commandHistory">
                                            <!-- Commands will be added here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Debug Console -->
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-bug me-2"></i>Debug Console
                            </div>
                            <div class="card-body">
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" id="debugCommand" placeholder="Enter RS-232 command (e.g., r power!)">
                                    <button class="btn btn-primary" id="sendDebugCmd">Send</button>
                                </div>
                                <div class="debug-console" id="debugOutput">
                                    <p class="text-muted mb-0">Debug output will appear here...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Shutdown Confirmation Modal -->
    <div class="modal fade" id="shutdownModal" tabindex="-1" aria-labelledby="shutdownModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-warning" id="shutdownModalLabel">
                        <i class="bi bi-exclamation-triangle me-2"></i>System Shutdown
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning" role="alert">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <strong>Warning:</strong> This will shut down the Raspberry Pi host system.
                    </div>
                    <p>Are you sure you want to shutdown the system? This will:</p>
                    <ul>
                        <li>Stop the Orei Control Panel service</li>
                        <li>Shut down the Raspberry Pi safely</li>
                        <li>Require physical power-on to restart</li>
                    </ul>
                    <p class="text-muted">
                        <i class="bi bi-info-circle me-1"></i>
                        The system will shutdown after 1 minute, giving you time to cancel if needed.
                    </p>
                    
                    <!-- Shutdown status display -->
                    <div id="shutdownStatus" style="display: none;">
                        <div class="alert alert-info" role="alert">
                            <div class="d-flex align-items-center">
                                <div class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></div>
                                <span id="shutdownMessage">Shutdown initiated...</span>
                            </div>
                            <div class="mt-2">
                                <small>Time remaining: <span id="shutdownCountdown">60</span> seconds</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div id="shutdownActions">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" id="confirmShutdownBtn">
                            <i class="bi bi-power me-2"></i>Shutdown System
                        </button>
                    </div>
                    <div id="shutdownActiveActions" style="display: none;">
                        <button type="button" class="btn btn-warning" id="cancelShutdownBtn">
                            <i class="bi bi-x-circle me-2"></i>Cancel Shutdown
                        </button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Restart Confirmation Modal -->
    <div class="modal fade" id="restartModal" tabindex="-1" aria-labelledby="restartModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-info" id="restartModalLabel">
                        <i class="bi bi-arrow-clockwise me-2"></i>System Restart
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info" role="alert">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>Information:</strong> This will restart the Raspberry Pi host system.
                    </div>
                    <p>Are you sure you want to restart the system? This will:</p>
                    <ul>
                        <li>Stop the Orei Control Panel service</li>
                        <li>Restart the Raspberry Pi safely</li>
                        <li>Automatically bring the system back online</li>
                    </ul>
                    <p class="text-muted">
                        <i class="bi bi-info-circle me-1"></i>
                        The system will restart in 1 minute, giving you time to cancel if needed.
                    </p>
                    
                    <!-- Restart status display -->
                    <div id="restartStatus" style="display: none;">
                        <div class="alert alert-warning" role="alert">
                            <div class="d-flex align-items-center">
                                <div class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></div>
                                <span id="restartMessage">Restart initiated...</span>
                            </div>
                            <div class="mt-2">
                                <small>Time remaining: <span id="restartCountdown">60</span> seconds</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div id="restartActions">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-info" id="confirmRestartBtn">
                            <i class="bi bi-arrow-clockwise me-2"></i>Restart System
                        </button>
                    </div>
                    <div id="restartActiveActions" style="display: none;">
                        <button type="button" class="btn btn-warning" id="cancelRestartBtn">
                            <i class="bi bi-x-circle me-2"></i>Cancel Restart
                        </button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Update Modal -->
    <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-success" id="updateModalLabel">
                        <i class="bi bi-download me-2"></i>System Update
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="updateCloseBtn"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info" role="alert">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>System Update:</strong> This will update the Orei Control Panel to the latest version.
                    </div>
                    <p>This update process will:</p>
                    <ul>
                        <li>Download the latest code from the repository</li>
                        <li>Update Python dependencies</li>
                        <li>Restart the control panel service</li>
                        <li>Preserve your current configuration</li>
                    </ul>
                    <p class="text-muted">
                        <i class="bi bi-clock me-1"></i>
                        The update process typically takes 1-2 minutes to complete.
                    </p>
                    
                    <!-- Update status display -->
                    <div id="updateStatus" style="display: none;" aria-live="polite">
                        <div class="alert alert-info" role="alert">
                            <div class="d-flex align-items-center">
                                <div class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></div>
                                <span>Update in progress...</span>
                            </div>
                        </div>
                        <div class="card mt-3">
                            <div class="card-header">
                                <h6 class="mb-0">Update Progress</h6>
                            </div>
                            <div class="card-body">
                                <pre id="updateOutput" class="bg-dark text-light p-3 mb-0" style="height: 300px; overflow-y: auto; font-size: 0.875rem;" role="log" aria-label="Update process output"></pre>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Update complete display -->
                    <div id="updateComplete" style="display: none;" aria-live="assertive">
                        <div class="alert alert-success" role="alert">
                            <i class="bi bi-check-circle me-2"></i>
                            <strong>Update Complete!</strong> The system has been successfully updated.
                        </div>
                        <p>The page will automatically refresh in <span id="refreshCountdown" aria-live="polite">5</span> seconds to show the updated version.</p>
                    </div>
                    
                    <!-- Update error display -->
                    <div id="updateError" style="display: none;" aria-live="assertive">
                        <div class="alert alert-danger" role="alert">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            <strong>Update Failed:</strong> <span id="updateErrorMessage"></span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div id="updateActions">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-success" id="confirmUpdateBtn">
                            <i class="bi bi-download me-2"></i>Start Update
                        </button>
                    </div>
                    <div id="updateActiveActions" style="display: none;">
                        <button type="button" class="btn btn-warning" id="cancelUpdateBtn">
                            <i class="bi bi-x-circle me-2"></i>Cancel Update
                        </button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Roku Device Configuration Modal -->
    <div class="modal fade" id="rokuConfigModal" tabindex="-1" aria-labelledby="rokuConfigModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="rokuConfigModalLabel">
                        <i class="bi bi-tv me-2"></i>Roku Device Configuration
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-4">
                        <h6>Current Device Mappings</h6>
                        <div id="currentMappingsModal">
                            <p class="text-muted">No devices mapped</p>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6>Device Discovery</h6>
                            <button class="btn btn-primary" id="discoverRokuBtnModal">
                                <i class="bi bi-search"></i> Discover Devices
                            </button>
                        </div>
                        
                        <div id="discoveredDevicesModal">
                            <p class="text-muted">Click "Discover Devices" to find Roku devices on your network</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="saveMappingsBtn">
                        <i class="bi bi-check"></i> Save Configuration
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="static/js/main.js?v=20250605091045"></script>
</body>
</html>